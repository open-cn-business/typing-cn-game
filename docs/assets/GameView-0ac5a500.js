var b=Object.defineProperty;var z=(s,t,e)=>t in s?b(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var o=(s,t,e)=>(z(s,typeof t!="symbol"?t+"":t,e),e);import{d as F,o as $,g as D,_ as B,a as E,c as I,b as v,e as G,n as P,u as M,r as m,f as V,t as C,h as Y,i as A,j as N}from"./index-12a8b8f6.js";class j{constructor(t,e,n){this.canvas=t,this.x=e,this.y=n}reset(t){t.drawImage(this.canvas.canvas,this.x,this.y)}clear(t){t.clearRect(this.x,this.y,this.canvas.canvas.width,this.canvas.canvas.height)}}class q{constructor(t,e){this.char=t,this.color=e}}class Z{constructor(t,e,n,i){o(this,"defaultEnFontFamily","Comic Sans MS");o(this,"defaultCnFontFamily","Ma Shan Zheng");o(this,"canvas");o(this,"ctx");o(this,"distance",20);o(this,"pinyinMarginLeft",0);o(this,"greenColor","hsla(160, 100%, 37%, 1)");this.word=t,this.letters=e,this.fontSize=n,this.cnWord=i,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.render()}makeAllGreen(){this.letters.forEach((t,e)=>{t.color=this.greenColor}),this.cnWord.color=this.greenColor,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.render()}makeCharGreen(t){this.letters[t].color=this.greenColor,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.render()}makeCharRed(t){this.letters[t].color="red",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.render()}render(){this.ctx.font=`${this.fontSize}px '${this.defaultEnFontFamily}', '${this.defaultCnFontFamily}', sans-serif`,this.ctx.textBaseline="middle";const t=this.ctx.measureText(this.word).width,e=this.ctx.measureText(this.cnWord.char).width;this.canvas.width=Math.max.apply(null,[t,e]),this.pinyinMarginLeft=(this.canvas.width-t)/2;const n=this.fontSize*1.5;this.canvas.height=n*2+this.distance,this.ctx.font=`${this.fontSize}px '${this.defaultEnFontFamily}', '${this.defaultCnFontFamily}', sans-serif`,this.ctx.textBaseline="middle",this.letters.forEach((i,h)=>{this.ctx.fillStyle=i.color;const d=this.getLetterXPosition(h),l=n/2;this.ctx.fillText(i.char,d,l)}),this.ctx.fillStyle=this.cnWord.color,this.ctx.fillText(this.cnWord.char,(this.canvas.width-e)/2,n+this.distance)}getLetterXPosition(t){let e=this.pinyinMarginLeft;for(let n=0;n<t;n++)e+=this.ctx.measureText(this.letters[n].char).width;return e}}class X{constructor(t,e){o(this,"ctx");o(this,"canvas");o(this,"defaultEnFontFamily","Comic Sans MS");o(this,"defaultCnFontFamily","Ma Shan Zheng");o(this,"childCanvasArray",[]);o(this,"charArr",[]);o(this,"waitForInput","");o(this,"currentWordIndex",0);o(this,"charIndexInWord",0);o(this,"finishedEvent");o(this,"typeErrorEvent");o(this,"typeCharSuccess");this.pinYin=t,this.word=e,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.render()}setFinishedEvent(t){if(typeof t!="function")throw new Error("Parameter must be a function");this.finishedEvent=t}setTypeSuccessEvent(t){if(typeof t!="function")throw new Error("Parameter must be a function");this.typeCharSuccess=t}setTypeErrorEvent(t){if(typeof t!="function")throw new Error("Parameter must be a function");this.typeErrorEvent=t}mapChar(t){return console.log("mapChar",t),t=="a"||t=="A"||t=="ā"||t=="á"||t=="ǎ"||t=="à"?"a":t=="b"||t=="B"||t=="ḃ"?"b":t=="c"||t=="C"||t=="ĉ"?"c":t=="d"||t=="D"||t=="ḋ"?"d":t=="e"||t=="E"||t=="ē"||t=="é"||t=="ě"||t=="è"?"e":t=="f"||t=="F"||t=="f̄"?"f":t=="g"||t=="G"||t=="ǵ"?"g":t=="h"||t=="H"||t=="ĥ"?"h":t=="i"||t=="I"||t=="ī"||t=="í"||t=="ǐ"||t=="ì"?"i":t=="j"||t=="J"||t=="ǰ"?"j":t=="k"||t=="K"||t=="ḱ"?"k":t=="l"||t=="L"||t=="l̄"?"l":t=="m"||t=="M"||t=="m̄"||t=="ḿ"||t=="m̀"?"m":t=="n"||t=="N"||t=="ń"||t=="ň"||t=="ǹ"?"n":t=="o"||t=="O"||t=="ō"||t=="ó"||t=="ǒ"||t=="ò"?"o":t=="p"||t=="P"||t=="ṕ"?"p":t=="q"||t=="Q"||t=="ɢ"?"q":t=="r"||t=="R"||t=="ŕ"?"r":t=="s"||t=="S"||t=="ŝ"?"s":t=="t"||t=="T"||t=="ṯ"?"t":t=="u"||t=="U"||t=="ü"||t=="ǜ"||t=="ǚ"||t=="ǘ"||t=="ū"||t=="ú"||t=="ǔ"||t=="ù"?"u":t=="v"||t=="V"||t=="ṽ"?"v":t=="w"||t=="W"||t=="ẁ"?"w":t=="x"||t=="X"||t=="ẋ"?"x":t=="y"||t=="Y"||t=="ȳ"||t=="ý"||t=="ỳ"?"y":t=="z"||t=="Z"||t=="ẑ"?"z":t}append(t){if(this.ctx&&this.canvas){const e=this.childCanvasArray[this.currentWordIndex];if(!e)return;let n=this.charArr[this.currentWordIndex];e.clear(this.ctx),t==this.waitForInput?n.length===this.charIndexInWord+1?(e.canvas.makeAllGreen(),this.currentWordIndex++,this.charIndexInWord=0,n=this.charArr[this.currentWordIndex],this.currentWordIndex==this.charArr.length?typeof this.finishedEvent=="function"&&this.finishedEvent():this.waitForInput=this.mapChar(n[this.charIndexInWord])):(typeof this.typeCharSuccess=="function"&&this.typeCharSuccess(t),e.canvas.makeCharGreen(this.charIndexInWord),this.charIndexInWord++,this.waitForInput=this.mapChar(n[this.charIndexInWord])):(typeof this.typeErrorEvent=="function"&&this.typeErrorEvent(this.waitForInput,t),e.canvas.makeCharRed(this.charIndexInWord)),e.reset(this.ctx)}}render(){this.ctx&&this.canvas&&(this.childCanvasArray=[],this.currentWordIndex=0,this.charIndexInWord=0,this.charArr=[],this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.draw())}draw(){if(!this.pinYin||!this.word)return;const t=30,e=this.pinYin.split(" "),n=this.word.split("");let i=10,h=0;for(let d=0;d<e.length;d++){const l=e[d],u=n[d],x=l.split("").map(p=>new q(p,"grey"));this.charArr=[...this.charArr,l.split("")];const g=new Z(l,x,t,{char:u,color:"grey"});this.childCanvasArray.push(new j(g,i,20)),i+=g.canvas.width+20,h=g.canvas.height}this.waitForInput=this.mapChar(this.charArr[0][0]),this.canvas.width=i+10,this.canvas.height=h,this.ctx.fillStyle="white",this.ctx.fillRect(0,0,i+10,h),this.ctx.font=`30px '${this.defaultEnFontFamily}', '${this.defaultCnFontFamily}', Arial`,this.ctx.fillStyle="#000",this.childCanvasArray.forEach(d=>{this.ctx.drawImage(d.canvas.canvas,d.x,20)})}}const H=F({name:"PinYinBlock",props:{word:{type:String,default:""},pinyin:{type:String,default:""}},setup(s,{emit:t}){const e=D();let n,i,h;const d=(p,a)=>{const f=new X(p,a);return f.setFinishedEvent(()=>{t("finished",{})}),f.setTypeSuccessEvent(y=>{t("typeSuccess",{key:y})}),f.setTypeErrorEvent((y,_)=>{t("typeError",{expect:y,actual:_})}),f};let l=0,u=0;$(()=>{n=d(s.pinyin,s.word),h=e==null?void 0:e.refs.canvas,i=h.getContext("2d"),i&&(i.fillStyle="white",i.fillRect(0,0,h.width,h.height),i.drawImage(n.canvas,l,u))});function x(p){n.append(p),i.clearRect(l,u,n.canvas.width,n.canvas.height),i.drawImage(n.canvas,l,u)}function g(p=s.word,a=s.pinyin,f,y){i.clearRect(l,u,n.canvas.width,n.canvas.height),n=d(a,p),f&&y?(i.drawImage(n.canvas,f,y),l=f,u=y):(l=Math.random()*(h.width-n.canvas.width),u=Math.random()*(h.height-n.canvas.height),i.drawImage(n.canvas,l,u))}return{render:g,append:x}}});const K={class:"container"},U={ref:"canvas",width:"900",height:"500"};function J(s,t,e,n,i,h){return E(),I("div",K,[v("canvas",U,null,512)])}const O=B(H,[["render",J]]),Q={class:"progress-bar"},tt=F({__name:"Progress",props:{currentValue:{type:Number,required:!0,validator:s=>s>=0&&s<=100},maxValue:{type:Number,required:!0,validator:s=>s>0}},setup(s){const t=s,e=G(()=>`${t.currentValue/t.maxValue*100}%`);return(n,i)=>(E(),I("div",Q,[v("div",{class:"progress-bar-inner",style:P({width:M(e)})},null,4)]))}});const et=B(tt,[["__scopeId","data-v-9254d19c"]]),nt={class:"con"},st={class:"top-bar"},it={style:{"font-family":"'Ma Shan Zheng'"}},rt=v("div",{style:{flex:"1"}},null,-1),ot={style:{"font-family":"'Ma Shan Zheng'","margin-top":"6px"}},at={style:{color:"hsla(160, 100%, 37%, 1)"},class:"cnFont"},lt={class:"cnFont"},ct=F({__name:"GameBoard",setup(s){let t=[];const e=(r,c)=>Math.floor(Math.random()*(c-r+1))+r,n=()=>{const r=new Set;d.value=0,l.value=0,a=0,u.value=0,fetch(`/typing-cn-game/assets/dict-${e(0,2)}.json`).then(c=>c.json()).then(c=>{var W;for(;r.size<e(75,150);){const w=Math.floor(Math.random()*(c.length-1));r.add(w)}t=[],Array.from(r).forEach(w=>{t.push({pinyin:c[w].pinyin,word:c[w].word,other:c[w]})}),p.value=!1,l.value=t.length,a=0,u.value=1,(W=_.value)==null||W.render(t[a].word,t[a].pinyin),x.value=t[a].other.explanation,g.value=t[a].other.derivation})},i=m(""),h=m(""),d=m(0),l=m(t.length),u=m(1),x=m(""),g=m(""),p=m(!1);let a=0;const f=new Audio("/typing-cn-game/music/typingGood.mp3"),y=new Audio("/typing-cn-game/music/typingBad.mp3"),_=m(null),S=m(),k=r=>{var w;if(console.log("event",r.key),r.key.length>1)return;const c=r.key.charAt(0).charCodeAt(0);(r.key==","||c>=65&&c<=90||c>=97&&c<=122)&&(f.paused||f.pause(),f.play(),(w=_.value)==null||w.append(r.key.toLowerCase()))},R=r=>{var c;if(console.log("finished",r),d.value+=3*t[a].word.length,a++,a==t.length){p.value=!0;return}u.value=a+1,(c=_.value)==null||c.render(t[a].word,t[a].pinyin),console.log("zzq see",t[a].other),x.value=t[a].other.explanation,g.value=t[a].other.derivation},T=r=>{y.play()},L=r=>{console.log("success",r.key),f.play()};return $(()=>{n(),setTimeout(()=>{document.addEventListener("click",()=>{var r;(r=S.value)==null||r.play()},{once:!1})},1e3),window.addEventListener("keydown",k)}),V(()=>{window.removeEventListener("keydown",k)}),(r,c)=>(E(),I("div",nt,[v("div",st,[v("div",null,[v("h1",it,"分数: "+C(d.value),1)]),rt,p.value?(E(),I("div",{key:0,class:"again",onClick:n}," 再来一次 ")):Y("",!0),v("div",null,[v("h2",ot,C(u.value)+" / "+C(M(t).length),1)])]),A(et,{class:"progress","current-value":u.value,"max-value":l.value},null,8,["current-value","max-value"]),v("audio",{autoplay:"",loop:"",ref_key:"audioRef",ref:S,src:"/typing-cn-game/music/gameMusic.mp3"},null,512),A(O,{onFinished:R,onTypeSuccess:L,onTypeError:T,pinyin:i.value,word:h.value,ref_key:"childRef",ref:_},null,8,["pinyin","word"]),v("h2",at,"释义："+C(x.value),1),v("div",lt,"出处："+C(g.value),1)]))}});const ut=F({__name:"GameView",setup(s){return(t,e)=>(E(),N(ct))}});export{ut as default};
